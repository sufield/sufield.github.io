<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>The Hidden Assumption That Took Down the Internet: The Cloudflare November 2025 Outage and the Danger of Implicit Invariants â€“ RCP</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="../static/bulma.min.css">
</head>
<body>
  <section class="section">
    <div class="container">
      <nav class="navbar" role="navigation">
        <div class="navbar-brand">
          <a class="navbar-item" href="../index.html">
            <strong>RCP</strong>&nbsp;<span>Runtime Control Plane</span>
          </a>
        </div>
      </nav>

      <h1 class="title">The Hidden Assumption That Took Down the Internet: The Cloudflare November 2025 Outage and the Danger of Implicit Invariants</h1>

      <div class="content is-size-4">
        
        <p>On November 18, 2025, Cloudflare's network began experiencing significant failures to deliver core network traffic after a change to a database system used by its Bot Management feature pipeline.</p>

        
        
        <div class="card">
          <div class="card-content">
            <p class="title">
              Hidden Invariants Break Without Warning
            </p>
          </div>
        </div>
        

        
        

<p>The incident was triggered when a change to database permissions caused the query that generates a Bot Management "feature file" to return duplicate feature rows, which increased the size of that file. The proxy software that processes this file enforced a limit on the number of features it could load; when the larger-than-expected file was propagated across the network, that limit was exceeded and the software failed, returning HTTP 5xx errors.</p>

<h2>How the Failure Developed</h2>
<p>Cloudflare later explained that a permissions change in a ClickHouse cluster caused a query used by the feature-file generator to start returning additional metadata. This more than doubled the number of features described in the generated file. When files with more than the allowed number of features were distributed, the Bot Management module hit its configured limit and panicked, which in turn caused errors in the core proxy handling customer traffic.</p>

<h2>The Cascade</h2>
<p>Based on Cloudflare's public post-incident report, the sequence of events was:</p>
<ol>
  <li>A change to database permissions altered the behavior of a ClickHouse query used to generate the Bot Management feature file.</li>
  <li>The query began returning duplicate feature metadata, increasing the number of features in the generated file.</li>
  <li>The resulting feature file exceeded the Bot Management module's configured limit on the number of features it could load.</li>
  <li>The larger-than-expected feature file was propagated across the network to machines running the proxy software.</li>
  <li>When the proxy loaded the file, the Bot Management module hit the feature limit and triggered a panic, producing HTTP 5xx errors.</li>
  <li>While the change was partially rolled out, the system alternated between good and bad files until all nodes generated the bad configuration and the failures stabilized.</li>
  <li>Cloudflare mitigated the incident by stopping generation of the bad feature file, inserting a known-good file into the distribution queue, and restarting affected services.</li>
</ol>

<h2>What Might Help Prevent Similar Incidents</h2>
<p>Cloudflare's write-up notes that assumptions about database query behavior and feature limits contributed to the outage. Making such limits explicit at the interface between configuration-generation systems and runtime modules, and validating generated artifacts against those limits before network-wide rollout, can reduce the risk that a change in one component will cause unexpected failures in another.</p>

<h2>Broader Context</h2>


        
        
        <blockquote class="is-size-3">
          The 30-second timeout was added three years ago. It worked fine in testing. It worked fine in staging. It was never formally validated against actual runtime behavior.
        </blockquote>
        

        
        <p>Safety-critical fields such as aviation, space, and nuclear operations commonly treat assumptions and limits as explicit contracts and use procedures and automated checks to verify them during design, testing, and operation. Applying similar discipline to large-scale cloud infrastructure is one way to reduce the impact of configuration and integration errors.</p>

      </div>

      <p class="mt-3">
        <a href="../index.html">&larr; Back to all articles</a>
      </p>
    </div>
  </section>
</body>
</html>
